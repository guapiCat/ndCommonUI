import{n as P}from"./nd-button-b0caaf9a.js";import{_ as U,g as p,s as O,Z as J,j as W,o as $,c as j,m as X,d as k,G as Y,ar as ee,b as D,w as te,y as ae,P as se,Q as ne}from"./app-df2347b2.js";const le=["onDragover"],ie=["accept"],oe={__name:"nd-selectfile",props:{extension:{type:Object,default:{}}},emits:["fn"],setup(u,{expose:_,emit:f}){const m=u,h=e=>e<1024*1024?(e/1024).toFixed(0)+" K":e<1024*1024*1024?(e/(1024*1024)).toFixed(2)+" M":(e/(1024*1024*1024)).toFixed(2)+" G",w=e=>{let t=r(e);return t==".zip"||t==".7z"||t==".rar"},r=e=>{let t=e.split(".");if(t.length==1)return"NoSuffixes";let a=t.pop();return isNaN(Number(a,10))?"."+a.toLowerCase():"."+t.pop().toLowerCase()+".*"},c=(e,t,a)=>{var s=x(e,t.toLowerCase());if(s){var n=t.toLowerCase().indexOf(".prt");if(n>0){var i=t.trim().substr(n+4);i.length>0&&(s=!1),a==1&&(s=!1)}}return s},x=(e,t)=>{var a=e.split(",");let s=r(t);for(var n=0;n<a.length;n++){var i=a[n].toLowerCase(),o="."+a[n].toLowerCase();if(i!=""&&o!=""&&(s==i||s==o))return!0}return!1},A=(e,t)=>{var a=e.split(",");let s=!1,n=r(t);return a.forEach(i=>{i==n&&(s=!0)}),s},v=p(0),y=p(null),b=p(null),d=p(1),F=p(!1);p("");const l=O({zuuid:"",allFileNums:0,allFileSize:0,readyUpfileList:[]});p([]);const B=e=>{if(e.stopPropagation(),e.preventDefault(),d.value=1,g(),e.dataTransfer.items){if(e.dataTransfer.items.length>1){ee({message:"抱歉，当前仅支持打开单个文件、文件夹",center:!0,duration:2e3,type:"warning"});return}window.waitForHandle&&(window.waitForHandle=null),F.value=!0,L(e.dataTransfer.items[0].webkitGetAsEntry(),""),M()}},H=e=>{e.stopPropagation(),e.preventDefault()},G=()=>{y.value.value="",d.value=1,g(),y.value.click()},Z=()=>{b.value.value="",d.value=2,g(),b.value.click()},C=()=>{l.zuuid=new Date().getTime()+String(Math.ceil(Math.random()*100)),f("fn",d.value,l),T(!1)},T=e=>{F.value=e},g=()=>{v.value=0,l.allFileNums=0,l.allFileSize=0,l.readyUpfileList=[]},V=e=>{let t=new Date().getTime()+String(Math.ceil(Math.random()*10));g(),l.readyUpfileList=Object.values(e).map(a=>{l.allFileNums++,l.allFileSize+=a.size;let s=a.webkitRelativePath?a.webkitRelativePath:a.name;return I(a,s,t)})},z=async e=>{T(!0),window.waitForHandle&&(window.waitForHandle=null);let t=e.target.files;t.length>0&&(g(),V(t),C())},L=(e,t,a)=>{if(a||(a=new Date().getTime()+String(Math.ceil(Math.random()*10))),e&&e.isFile&&(d.value!=2&&(d.value=1),console.log("tempFiles",e),e.file(n=>{l.allFileNums++,l.allFileSize+=n.size,l.readyUpfileList.push(I(n,t+n.name,a))})),e&&e.isDirectory){d.value=2;let n=e.createReader();var s=function(i){i.forEach(function(o,R){setTimeout(()=>{L(o,o.fullPath.replace(o.name,""),a)},0)}),i.length>0&&n.readEntries(s)};n.readEntries(s)}},I=(e,t,a)=>{v.value++;let s=x(m.extension.extension,e.name),n=w(e.name),i=r(e.name),o=A(m.extension.blackExt,e.name),R=c(m.extension.assemblyExt,e.name,d.value),Q=h(e.size),S=new FormData,E="temp/upload/"+a,N=t.lastIndexOf("/")>0?"/"+t.substr(0,t.lastIndexOf("/"))+"/"+e.name:"/"+e.name,q=E+N;return o&&(s=!1),S.append("file",e),S.append("file",e),{isAllow:s,isBlack:o,isMainType:R,file:e,isZip:n,fileReversed:i,name:e.name,isSelect:!1,path:t,folderPath:t.substr(0,t.lastIndexOf("/")),sizeAuto:Q,haveUpload:0,size:e.size,fs_id:new Date().getTime()+String(Math.ceil(Math.random()*1e6))+v.value,uid:new Date().getTime()+String(Math.ceil(Math.random()*1e6))+v.value,formData:S,md5Value:"",ossBasePath:E,shortPathName:N,ossFullPath:q,typeImg:K(e.name)}},K=e=>{e=e.toLowerCase();let t=r(e);return t.indexOf(".prt")>-1?"/images/fileType/default.png":t.indexOf(".asm.")>-1?"/images/fileType/proE.png":t==".session"?"/images/fileType/catia.png":`/images/fileType/${t.substring(1)}.png`},M=e=>{let t=0;e&&(t=e);let a=l.allFileSize,s=30;t==3&&a==0&&(s=500);let n=setTimeout(()=>{if(t>5)return console.log("uploadInfo",l),C(),clearTimeout(n),n=null,!1;l.allFileSize>a?(l.readyUpfileList.length>1&&T(!0),a=l.allFileSize):t++,M(t)},s)};return _({openFile:G,openFolder:Z}),(e,t)=>{const a=J("loading");return W(($(),j("div",{class:"z-selct",draggable:"true",onDrop:B,onDragover:Y(H,["prevent"])},[X(e.$slots,"default",{},void 0,!0),k("input",{ref_key:"fileRef",ref:y,accept:u.extension.extension,type:"file",onChange:z,style:{display:"none"}},null,40,ie),k("input",{ref_key:"folderRef",ref:b,type:"file",onChange:z,webkitdirectory:"true",style:{display:"none"}},null,544)],40,le)),[[a,F.value]])}}},re=U(oe,[["__scopeId","data-v-fe8114a0"],["__file","nd-selectfile.vue"]]);const ce=u=>(se("data-v-e82c5216"),u=u(),ne(),u),de={class:"operation-box"},pe=ce(()=>k("div",{style:{margin:"12px 0"}},"可将文件/文件夹拖拽到此区域",-1)),ue={__name:"ndSelectfile",setup(u){const _=O({extension:{extension:".session,.catproduct,.iam,.prt,.asm,.asm.*,.sldasm,.PRT,.4d,.xmp_txt,.CATPart,.CATDrawing,.CGR,.ipt,.x_t,.x_b,.prt.*,.par,.psm,.SLDPRT,.stp,.step,.vda,.stl,.jt,.igs,.iges,.3dxml,.model,.3dm,.obj,.sab,.obj,.3mf,.asat,.asab,.sab,.model,.xmt_txt,.xmt_bin,.p_b,.xmp_bin,.p_t,.xmp_txt,.catdrawing,.exp,.xcgm,.stpZ,.stpx,.houzhuitest6,.cgr,.sat,.dxf,.exb,.dwg",blackExt:"exe,bat,iso,dll,msi,asp,aspx,php,jsp",assemblyExt:".session,.catproduct,.iam,.prt,.asm,.asm.*,.sldasm",openFileSizeTimeScope:""}}),f=p(null),m=(r,c)=>{console.log("类型:(1:文件   2:文件夹)",r),console.log("文件信息:",c)},h=()=>{f.value.openFile()},w=()=>{f.value.openFolder()};return(r,c)=>($(),j("div",de,[D(ae(re),{ref_key:"childRef",ref:f,onFn:m,extension:_.extension},{default:te(()=>[pe,D(P,{type:"warning",onClick:c[0]||(c[0]=x=>h()),content:"选择文件"}),D(P,{style:{"margin-left":"20px"},type:"warning",onClick:c[1]||(c[1]=x=>w()),content:"选择文件夹"})]),_:1},8,["extension"])]))}},ge=U(ue,[["__scopeId","data-v-e82c5216"],["__file","ndSelectfile.vue"]]);export{ge as default};
